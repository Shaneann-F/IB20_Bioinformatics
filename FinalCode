#This shell script is to look for two genes in any target species
#This script creates three directories: OutputDirectory, ReferenceDirectory, and TargetDirectory
#Arguments within the shell script are as follows $1=hsp70*.fasta reference genes, $2=mcr*.fasta reference genes, $3=proteome*.fasta
#The output containing target species with both reference genes present will be presented in a table.
#You should make 3 directories using the Mkdir command to correspond to ReferenceDirectory, TargetDirectory and OutputDirectory
#The OutputDirectory will contain all outputs, ReferenceDirectory will house the reference genes 1 and 2, and the TargetDirectory will hold the target species gene sequences.


#We combine all files for gene1 into one fasta file
#Make sure that the directory for your tools hmmr and muscle correspond to your pathway. Ours are located two directories above. 
#We then align the files with muscle
#We then build a regular expression using the tool hmmbuild

for gene in “$1”
do
cat $gene >> gene1.fa
done
../../muscle -in gene1.fasta -out gene1.afa
../../hmmbuild gene1.hmm gene1.afa

#We combine all files for gene2 into one fasta file. 
#Make sure that the directory for your tools hmmr and muscle correspond to your pathway. Ours are located two directories above.
#We then align the files with muscle
#We then build a regular expression using the tool hmmbuild

for gene in "$2"
do
cat $gene >> gene2.fa
done
../../muscle -in gene2.fasta -out gene2.afa
../../hmmbuild gene2.hmm gene2.afa


#This loop is for hmm search to generate a table for gene1 and gene2 using the target sequence in the TargetDirectory
#Now we search for the proteomes which contain hsp and mcr genes of interest

for proteome in "$3”
do
../../hmmsearch --tblout genesOfInterest1.tblout gene1.hmm gene1.afa $proteome | grep ^WP_ | wc -l >> matches1.txt
../../hmmsearch --tblout genesOfInterest2.tblout gene2.hmm gene2.afa $proteome | grep ^WP_ | wc -l >> matches2.txt
done

#We now append the two match[1,2].txt files into a new file with three columns: Target Species, Match 1, Match 2 respectively
#First we generate the table with Target species with a for loop. This should give the respective target sequence followed by their reference genes

for column in "$3"
do echo $column >> proteomename.txt
done

#We combine all columns into one file.
paste proteomename.txt matches1.txt matches2.txt > matchescombined.txt


#Now we organize our proteome matches
cat matchescombined.txt | grep -v “ 0” | sort -k 2 -n >> finalMatches.csv


